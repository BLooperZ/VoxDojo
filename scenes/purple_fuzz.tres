[gd_resource type="ShaderMaterial" load_steps=5 format=3 uid="uid://ufi8n16eer5o"]

[ext_resource type="Texture2D" uid="uid://dwrt4axvf33r1" path="res://graphics/fuzzy.png" id="1_n7sp5"]

[sub_resource type="Shader" id="Shader_8vs1c"]
code = "shader_type canvas_item;

uniform sampler2D noise1 : repeat_enable;
uniform sampler2D noise2 : repeat_enable;
uniform vec3 tint : source_color;
uniform float hair_length = 0.015;
uniform float fiber_stretch = 0.02;
uniform float time_scale = 0.001;

uniform vec2 light_direction = vec2(0.6, 0.4); // Adjust for lighting angle
uniform float shadow_strength = 0.7;
uniform float outline_strength = 0.3; // Controls outline intensity

void fragment() {
    vec2 uv = UV;

    // Sample noise textures
    float noise1_value = texture(noise1, uv + 0.005 * cos(0.25 * TIME)).r - 0.5;
    float noise2_value = texture(noise2, uv - 0.002 * sin(0.8 * TIME)).r - 0.5;
    float mixed_noise = noise1_value * noise2_value * 2.0;

    // Stretch noise into directional fibers
    vec2 fiber_offset = vec2(noise1_value, noise2_value) * fiber_stretch;

    // Original texture distortion
    vec2 base_offset = vec2(0.1, 0.1) * mixed_noise;

    // Sample base texture with fiber stretching
    vec4 base_color = texture(TEXTURE, uv + base_offset + fiber_offset);

    // Edge detection for extra fuzz
    float edge_factor = smoothstep(0.3, 0.6, base_color.a);

    // Generate edge hairs
    vec2 hair_offset = vec2(noise1_value, noise2_value) * hair_length * edge_factor;

    // Final base texture output
    vec3 final_color = texture(TEXTURE, uv + base_offset + fiber_offset + hair_offset).rgb;
    final_color = 0.05 * final_color + 0.9 * (0.09 * (1.0 - base_color.a) + tint * 0.5 * (noise1_value + 0.8));

    // **Outline Calculation**
    vec3 outline_color = tint * 0.4;  // Slightly darker shade
    float outline_factor = smoothstep(0.1, 0.6, base_color.a) * outline_strength;

    // Blend outline **without overriding base texture**
    final_color = mix(final_color, outline_color, outline_factor);

    COLOR = vec4(final_color, base_color.a * (1.0 + edge_factor * 0.2)); // Preserve fuzz & outline

	// **UV-Based Shadow Calculation**
    float shadow_factor = dot((0.2 * (1.0 - SCREEN_UV) + 0.6 * uv), light_direction); // Light direction influence
    shadow_factor = smoothstep(0.2, 0.8, shadow_factor) * shadow_strength; // Control transition


    COLOR.rgb += tint * (0.5 + 0.4 * mixed_noise - shadow_factor);; // Soft alpha extension for fuzzy edges
}"

[sub_resource type="FastNoiseLite" id="FastNoiseLite_fbq8q"]
noise_type = 4
frequency = 0.0222

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_3jjwm"]
noise = SubResource("FastNoiseLite_fbq8q")

[resource]
shader = SubResource("Shader_8vs1c")
shader_parameter/tint = Color(0.827151, 0.426938, 0.87899, 1)
shader_parameter/hair_length = 0.02
shader_parameter/fiber_stretch = 0.05
shader_parameter/time_scale = 0.02
shader_parameter/light_direction = Vector2(0.6, 0.4)
shader_parameter/shadow_strength = 0.5
shader_parameter/outline_strength = 0.3
shader_parameter/noise1 = ExtResource("1_n7sp5")
shader_parameter/noise2 = SubResource("NoiseTexture2D_3jjwm")
